@model BalkanTech.Web.ViewModels.TaskViewModel
@{
    ViewData["Title"] = "Room Tasks Overview";
}

<div class="container mt-5">
    <h1 class="mb-4 text-center">Tasks for Room @Model.RoomNumber</h1>

    <div class="btn-group mb-4 d-flex justify-content-center" role="group" aria-label="Category Filter">
        @foreach (var category in Model.Categories)
        {
            <button type="button" class="btn btn-secondary btn-sm mx-1" style="min-width: 100px;">@category</button>
        }
    </div>

    <div class="task-section mb-5">
        <h4 class="text-warning mb-3"><i class="bi bi-list-task"></i> To Be Completed Tasks</h4>
        <table class="table table-hover shadow-sm">
            <thead class="table-light">
                <tr>
                    <th>Description</th>
                    <th>Due Date</th>
                    <th>Category</th>
                    <th>Assigned Technicians</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ToBeCompletedTasks.Any())
                {
                    @foreach (var task in Model.ToBeCompletedTasks)
                    {
                        <tr>
                            <td>@task.Description</td>
                            <td>@task.DueDate.ToString("d")</td>
                            <td>@task.TaskCategory.Name</td>
                            <td>
                                @foreach (var tech in task.AssignedTechniciansTasks)
                                {
                                    <span class="badge bg-info me-1">@tech.AppUser.FirstName</span>
                                }
                            </td>
                            <td><span class="badge bg-warning text-dark">@task.Status</span></td>
                            <td class="text-center">
                                <a asp-page="./TaskDetail" asp-route-id="@task.Id" class="btn btn-primary btn-sm">
                                    <i class="bi bi-eye"></i> View
                                </a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted">No tasks to be completed.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="task-section">
        <h4 class="text-success mb-3"><i class="bi bi-check-circle"></i> Completed Tasks</h4>
        <table class="table table-hover shadow-sm">
            <thead class="table-light">
                <tr>
                    <th>Description</th>
                    <th>Completed Date</th>
                    <th>Category</th>
                    <th>Technicians</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.CompletedTasks.Any())
                {
                    @foreach (var task in Model.CompletedTasks)
                    {
                        <tr>
                            <td>@task.Description</td>
                            <td>@task.CompletedDate?.ToString("d")</td>
                            <td>@task.TaskCategory.Name</td>
                            <td>
                                @foreach (var tech in task.AssignedTechniciansTasks)
                                {
                                    <span class="badge bg-info me-1">@tech.AppUser.FirstName</span>
                                }
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-center text-muted">No completed tasks available.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
