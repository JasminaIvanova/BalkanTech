@model BalkanTech.Web.ViewModels.TaskViewModel
@{
    ViewData["Title"] = "Room Tasks Overview";
}

<div id="task-status-url" data-url="@Url.Action("ChangeTaskStatus", "Task")" style="display:none"></div>
<div class="container mt-5">
    <h1 class="mb-4 text-center">Tasks for Room @Model.RoomNumber</h1>

    <form method="get" action="@Url.Action("Index", "Task")" id="categoryForm">
        <input type="hidden" name="category" id="categoryInput" value="All" />
        <input type="hidden" name="roomNumber" value="@Model.RoomNumber" />
        <div class="btn-group mb-4 d-flex justify-content-center" role="group" aria-label="Category Filter">
            <button type="button" class="btn btn-secondary btn-sm mx-1" onclick="setCategory('All')">All</button>
            @foreach (var category in Model.Categories)
            {
                <button type="button" class="btn btn-secondary btn-sm mx-1" onclick="setCategory('@category')">@category</button>
            }
        </div>
    </form>

    <div class="task-section mb-5">
        <h4 class="text-warning mb-3"><i class="bi bi-list-task"></i> To Be Completed Tasks</h4>
        <table id="to-be-completed-tasks-table" class="table table-hover shadow-sm">
            <thead class="table-light">
                <tr>
                    <th>Name</th>
                    <th>Due Date</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.ToBeCompletedTasks.Any())
                {
                    @foreach (var task in Model.ToBeCompletedTasks)
                    {
                        <tr id="task-@task.Id">
                           
                            <td>@task.Name</td>
                            <td id="task-date-@task.Id">@task.DueDate.ToString("d")</td>
                            <td>@task.TaskCategory.Name</td>
                            <td>
                                @if (task.DueDate < DateTime.Now)
                                {
                                    <span id="task-passed-@task.Id"class="badge bg-danger text-dark">Due date passed</span>
                                }
                                @if (@task.Status == "Pending")
                                {
                                    <span id="task-status-@task.Id" class="badge bg-warning text-dark">@task.Status</span>

                                }
                                else if (@task.Status == "In Process")
                                {
                                <span id="task-status-@task.Id" class="badge bg-primary text-dark">@task.Status</span>
                                }
                            </td>
                            <td class="text-center">
                                <button onclick="changeTaskStatus('@task.Id', 'In Process', '@task.CompletedDate')" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-gear"></i> In Process
                                </button>
                                <button onclick="changeTaskStatus('@task.Id', 'Completed', '@DateTime.Now')" class="btn btn-outline-success btn-sm">
                                    <i class="bi bi-check-all"></i> Complete
                                </button>
                                <a href="@Url.Action("Details", "Task", new { id = task.Id })" class="btn btn-outline-dark btn-sm text-white">
                                    Details
                                </a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr class="text-attach">
                        <td colspan="6" class="text-center text-muted">No tasks to be completed.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="task-section">
        <h4 class="text-success mb-3"><i class="bi bi-check-circle"></i> Completed Tasks</h4>
        <table id="completed-tasks-table" class="table table-hover shadow-sm">
            <thead class="table-light">
                <tr>
                    <th>Name</th>
                    <th>Completed Date</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.CompletedTasks.Any())
                {
                    @foreach (var task in Model.CompletedTasks)
                    {
                        <tr id="task-@task.Id">
                            <td>@task.Name</td>
                            <td id="task-date-@task.Id">@task.CompletedDate?.ToString("d")</td>
                            <td>@task.TaskCategory.Name</td>
                            <td><span id="task-status-@task.Id" class="badge bg-success text-dark">@task.Status</span></td>
                            <td class="text-center">
                                <a href="@Url.Action("Details", "Task", new { id = task.Id })" class="btn btn-outline-dark btn-sm text-white">
                                    Details
                                </a>
                            </td>
                            
                        </tr>
                      
                    }
                }
                else
                {
                    <tr class="text-remove">
                        <td colspan="4" class="text-center">No completed tasks available.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.min.css">
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

